<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>System Diagnostic // EXPERIMENTAL</title>
    <style>
        :root {
            --bg-color: #0f0f0f;
            --panel-bg: rgba(20, 20, 20, 0.95);
            --accent-color: #00f3ff;
            --text-color: #e0e0e0;
            --danger-color: #ff3333;
            --font-mono: 'Courier New', Courier, monospace;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-mono);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: grid;
            grid-template-columns: 320px 1fr;
            transition: background-color 0.1s;
        }

        /* Desktop Sidebar */
        aside {
            background-color: var(--panel-bg);
            border-right: 1px solid #333;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.8);
            z-index: 10;
            backdrop-filter: blur(5px);
        }

        .logo {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--accent-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 15px;
            letter-spacing: 3px;
            text-transform: uppercase;
            text-shadow: 0 0 10px rgba(0, 243, 255, 0.3);
        }

        .control-group {
            border: 1px solid #333;
            padding: 16px;
            background: rgba(0, 0, 0, 0.4);
            border-left: 3px solid var(--accent-color);
        }

        .control-group h3 {
            margin: 0 0 15px 0;
            font-size: 0.8rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            font-family: var(--font-mono);
        }

        .metric-value {
            color: var(--accent-color);
            text-shadow: 0 0 5px rgba(0, 243, 255, 0.5);
        }

        input[type="range"] {
            width: 100%;
            background: transparent;
            -webkit-appearance: none;
            margin: 10px 0;
        }

        input[type="range"]::-webkit-slider-runnable-track {
            height: 4px;
            background: #333;
            border-radius: 2px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            background: var(--accent-color);
            border-radius: 50%;
            margin-top: -6px;
            cursor: pointer;
            box-shadow: 0 0 10px var(--accent-color);
        }

        /* Main Content */
        main {
            position: relative;
            background: radial-gradient(circle at center, #151515 0%, #050505 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .overlay-text {
            position: absolute;
            top: 25px;
            right: 25px;
            text-align: right;
            pointer-events: none;
            z-index: 5;
        }

        .status-line {
            font-size: 0.9rem;
            color: var(--accent-color);
            opacity: 0.8;
            margin-bottom: 6px;
            text-shadow: 0 0 5px rgba(0, 243, 255, 0.3);
        }

        /* The Button */
        .init-btn-container {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            width: 100%;
            display: flex;
            justify-content: center;
        }

        .init-btn {
            background: rgba(0, 0, 0, 0.6);
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
            padding: 20px 60px;
            font-family: var(--font-mono);
            font-size: 1.4rem;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 4px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.15);
            backdrop-filter: blur(4px);
        }

        .init-btn:hover {
            background: rgba(0, 243, 255, 0.15);
            box-shadow: 0 0 40px rgba(0, 243, 255, 0.4);
            text-shadow: 0 0 8px var(--accent-color);
            transform: scale(1.05);
        }

        .init-btn:active {
            transform: scale(0.95);
        }

        /* Hidden Config */
        .config-trigger {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 30px;
            height: 30px;
            opacity: 0.1;
            cursor: pointer;
            z-index: 100;
            border-radius: 50%;
            background: #fff;
            transition: opacity 0.3s;
        }

        .config-trigger:hover {
            opacity: 0.8;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 200;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: #1a1a1a;
            padding: 40px;
            border: 1px solid #444;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 0 50px rgba(0, 243, 255, 0.1);
            border-left: 4px solid var(--accent-color);
        }

        .modal-content h2 {
            margin-top: 0;
            color: var(--accent-color);
            font-size: 1.5rem;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }

        .modal-input {
            width: 100%;
            padding: 12px;
            background: #0f0f0f;
            border: 1px solid #333;
            color: #fff;
            margin: 15px 0;
            font-family: var(--font-mono);
            font-size: 1rem;
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .modal-btn {
            background: var(--accent-color);
            color: #000;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            font-weight: bold;
            font-family: var(--font-mono);
            transition: background 0.2s;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .modal-btn:hover {
            background: #00c4ce;
        }

        /* Glitch Effects */
        .glitch-mode body {
            animation: bg-flash 0.12s infinite;
        }

        .glitch-mode canvas {
            filter: hue-rotate(90deg) contrast(150%) saturate(150%);
        }

        .glitch-mode .init-btn {
            display: none;
        }

        @keyframes bg-flash {
            0% { background-color: #000; }
            25% { background-color: #200; }
            50% { background-color: #000; }
            75% { background-color: #002; }
            100% { background-color: #000; }
        }

        .shaker {
            animation: shake 0.5s cubic-bezier(.36, .07, .19, .97) both infinite;
            transform: translate3d(0, 0, 0);
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-2px, 0, 0); }
            20%, 80% { transform: translate3d(4px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-8px, 0, 0); }
            40%, 60% { transform: translate3d(8px, 0, 0); }
        }

        body.show-cookie-blocker::after {
            content: "VOLUME CONTROL DISABLED BY SYSTEM ADMIN";
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: red;
            color: white;
            padding: 20px;
            z-index: 10000;
            font-size: 2rem;
            font-weight: bold;
            border: 5px solid white;
            animation: blink 0.5s infinite;
            pointer-events: none;
            display: block;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        /* ----------------------- */
        /* MOBILE REDESIGN (UPDATED) */
        /* ----------------------- */
        @media (max-width: 768px) {
            body {
                display: block; /* No grid on mobile */
                height: 100vh;
                width: 100vw;
                position: relative;
            }

            /* Hide Sidebar initially, make it a slide-up panel or just minimal overlay */
            aside {
                position: absolute;
                bottom: 0;
                left: 0;
                width: 100%;
                height: auto;
                max-height: 250px; /* Peek or small */
                transform: translateY(100%); /* Hidden by default */
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                border-right: none;
                border-top: 2px solid var(--accent-color);
                padding: 15px;
                background: rgba(10, 10, 10, 0.95);
            }

            aside.visible {
                transform: translateY(0);
            }

            /* Fullscreen Main */
            main {
                width: 100%;
                height: 100%;
            }

            /* Better HUD elements for Mobile */
            .overlay-text {
                top: 15px;
                right: 15px;
                font-size: 0.8rem;
                background: rgba(0,0,0,0.5);
                padding: 5px 10px;
                border: 1px solid var(--accent-color);
                border-radius: 4px;
            }

            .logo {
                display: none; /* Hide logo in sidebar to save space */
            }

            /* Mobile Header Logo */
            .mobile-header {
                position: absolute;
                top: 20px;
                left: 20px;
                z-index: 5;
                color: var(--accent-color);
                font-weight: bold;
                letter-spacing: 2px;
                display: block;
                text-shadow: 0 0 5px var(--accent-color);
            }

            /* CENTERED AND HUGE BUTTON */
            .init-btn-container {
                bottom: 50%;
                transform: translate(-50%, 50%); /* Centered verticallyish */
                width: 90%;
            }

            .init-btn {
                width: 100%;
                padding: 25px;
                font-size: 1.5rem;
                background: rgba(0, 0, 0, 0.7);
                border: 2px solid var(--accent-color);
                animation: pulse-glow 2s infinite;
            }

            /* Mobile Stats Overlay */
            .mobile-stats {
                position: absolute;
                bottom: 20px;
                left: 20px;
                font-size: 0.7rem;
                color: #888;
                z-index: 5;
                font-family: var(--font-mono);
            }

            @keyframes pulse-glow {
                0% { box-shadow: 0 0 10px rgba(0, 243, 255, 0.2); }
                50% { box-shadow: 0 0 30px rgba(0, 243, 255, 0.6); border-color: #fff; }
                100% { box-shadow: 0 0 10px rgba(0, 243, 255, 0.2); }
            }
        }
    </style>
</head>

<body>

    <div class="mobile-header" style="display: none;">SYSTEM_DIAG_V4.2</div>
    <div class="mobile-stats" style="display: none;">
        CPU: <span id="m-cpu">12%</span> | MEM: <span id="m-mem">4GB</span>
    </div>

    <!-- Desktop Sidebar (Hidden on mobile initially) -->
    <aside id="sidebar-panel">
        <div class="logo">PHYX-SIM v4.2</div>

        <div class="control-group">
            <h3>Render Settings</h3>
            <div class="metric">
                <span>Particle Density</span>
                <span class="metric-value">4,200</span>
            </div>
            <input type="range" min="0" max="100" value="75" oninput="updateDummy(this)">

            <div class="metric">
                <span>Gravity Well</span>
                <span class="metric-value">9.81 m/s²</span>
            </div>
            <input type="range" min="0" max="100" value="50" oninput="updateDummy(this)">
        </div>

        <div class="control-group">
            <h3>System Diagnostics</h3>
            <div class="metric">
                <span>CPU Load</span>
                <span id="cpu-load" class="metric-value">12%</span>
            </div>
            <div class="metric">
                <span>GPU Temp</span>
                <span id="gpu-temp" class="metric-value">45°C</span>
            </div>
            <div class="metric">
                <span>Entropy</span>
                <span id="entropy" class="metric-value">0.003</span>
            </div>
        </div>

        <div class="control-group">
            <h3>Output Logs</h3>
            <div id="log-feed"
                style="font-size: 0.7rem; color: #666; height: 80px; overflow: hidden; display: flex; flex-direction: column-reverse;">
                <div>> Initializing render core...</div>
                <div>> Buffer clear...</div>
                <div>> System stable.</div>
            </div>
        </div>
    </aside>

    <main id="main-view">
        <canvas id="sim-canvas"></canvas>

        <div class="overlay-text">
            <div class="status-line">FPS: <span id="fps-counter">60</span></div>
            <div class="status-line">RUNTIME: <span id="sim-time">00:00:00</span></div>
            <div class="status-line" style="color:#0f0;">ONLINE</div>
        </div>

        <div class="init-btn-container">
            <button class="init-btn" id="start-btn">INITIALIZE SYSTEM</button>
        </div>
    </main>

    <!-- Hidden Configuration -->
    <div class="config-trigger" id="config-btn" title="Config"></div>
    <div class="modal" id="config-modal">
        <div class="modal-content">
            <h2>Configuration Payload</h2>
            <p>Audio URL (Defaults to internal 'prank_sound.mp3'):</p>
            <input type="text" id="audio-url" class="modal-input" placeholder="prank_sound.mp3">

            <p style="margin-top: 15px; margin-bottom: 5px;">Output Gain: <span id="vol-display">100%</span></p>
            <input type="range" id="audio-vol" min="0" max="1" step="0.1" value="1"
                style="width: 100%; margin-bottom: 20px;">

            <div style="display: flex; gap: 10px;">
                <button class="modal-btn" id="save-config">SAVE & DISARM</button>
                <button class="modal-btn" style="background: #333; color: #fff; border: 1px solid #555;" id="preview-audio">TEST</button>
            </div>
        </div>
    </aside>
    </div>

    <script>
        /**
         * PHYX-SIM v4.2
         * "Simulation" Logic and Prank Controller
         */

        // --- Configuration & State ---
        let config = {
            audioUrl: 'prank_sound.mp3', // Default to uploaded file
            volume: 1.0,
            isGlitching: false,
            particles: []
        };

        // --- DOM Elements ---
        const canvas = document.getElementById('sim-canvas');
        const ctx = canvas.getContext('2d');
        const startBtn = document.getElementById('start-btn');
        const configBtn = document.getElementById('config-btn');
        const configModal = document.getElementById('config-modal');
        const saveConfigBtn = document.getElementById('save-config');
        const audioInput = document.getElementById('audio-url');
        const volInput = document.getElementById('audio-vol');
        const volDisplay = document.getElementById('vol-display');
        const previewBtn = document.getElementById('preview-audio');
        const mainView = document.getElementById('main-view');

        // Check for mobile
        const isMobile = window.innerWidth <= 768;
        if (isMobile) {
            document.querySelector('.mobile-header').style.display = 'block';
            document.querySelector('.mobile-stats').style.display = 'block';
        }

        let audioCtx;

        // --- Resize Handling ---
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if(config.isGlitching) return; 
            initParticles(); // Re-init on resize for clean look
        }
        window.addEventListener('resize', resize);
        
        // --- Particle System (The Decoy) ---
        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.vx = (Math.random() - 0.5) * 1.5;
                this.vy = (Math.random() - 0.5) * 1.5;
                this.size = Math.random() * 2 + 1;
                this.color = '#00f3ff';
            }

            update() {
                if (config.isGlitching) {
                    this.x += (Math.random() - 0.5) * 80;
                    this.y += (Math.random() - 0.5) * 80;
                    this.vx += (Math.random() - 0.5) * 5;
                    this.vy += (Math.random() - 0.5) * 5;
                    this.color = `hsl(${Math.random() * 360}, 100%, 50%)`;
                    return;
                }

                this.x += this.vx;
                this.y += this.vy;

                // Bounce
                if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
                if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initParticles() {
            config.particles = [];
            const count = isMobile ? 60 : 150;
            for (let i = 0; i < count; i++) {
                config.particles.push(new Particle());
            }
        }
        // Force init
        resize();
        initParticles();

        function drawConnections() {
            if (config.isGlitching) return; 

            ctx.strokeStyle = 'rgba(0, 243, 255, 0.1)';
            ctx.lineWidth = 1;

            const maxDist = isMobile ? 80 : 120;

            for (let i = 0; i < config.particles.length; i++) {
                for (let j = i + 1; j < config.particles.length; j++) {
                    const dx = config.particles[i].x - config.particles[j].x;
                    const dy = config.particles[i].y - config.particles[j].y;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    if (dist < maxDist) {
                        // Opacity based on distance
                        ctx.globalAlpha = 1 - (dist / maxDist);
                        ctx.beginPath();
                        ctx.moveTo(config.particles[i].x, config.particles[i].y);
                        ctx.lineTo(config.particles[j].x, config.particles[j].y);
                        ctx.stroke();
                        ctx.globalAlpha = 1.0;
                    }
                }
            }
        }

        function animate() {
            // Trail effect
            ctx.fillStyle = config.isGlitching ? 'rgba(0,0,0,0.15)' : 'rgba(15, 15, 15, 0.25)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            config.particles.forEach(p => {
                p.update();
                p.draw();
            });

            drawConnections();

            // Random fake glitches in normal mode (rare)
            if (!config.isGlitching && Math.random() > 0.995) {
                ctx.fillStyle = 'rgba(0, 243, 255, 0.1)';
                ctx.fillRect(0, Math.random() * canvas.height, canvas.width, 4);
            }

            requestAnimationFrame(animate);
        }
        animate();


        // --- Dummy UI Updates ---
        setInterval(() => {
            if (config.isGlitching) return;
            document.getElementById('cpu-load').innerText = Math.floor(Math.random() * 15 + 10) + "%";
            document.getElementById('gpu-temp').innerText = Math.floor(Math.random() * 5 + 40) + "°C";
            document.getElementById('entropy').innerText = (Math.random() * 0.01).toFixed(4);
            document.getElementById('fps-counter').innerText = Math.floor(Math.random() * 5 + 58);
            
            if(isMobile) {
                document.getElementById('m-cpu').innerText = Math.floor(Math.random() * 15 + 10) + "%";
            }

            const now = new Date();
            document.getElementById('sim-time').innerText = now.toLocaleTimeString();

            // Add logs
            if (Math.random() > 0.8) {
                const logs = [
                    "> Calculating trajectory...",
                    "> Matrix normalization...",
                    "> Physics delta stable.",
                    "> Frame buffer refreshed.",
                    "> Vector alignment complete.",
                    "> Checking integrity..."
                ];
                const logFeed = document.getElementById('log-feed');
                const div = document.createElement('div');
                div.innerText = logs[Math.floor(Math.random() * logs.length)];
                logFeed.prepend(div);
                if (logFeed.children.length > 20) logFeed.lastChild.remove();
            }
        }, 800);

        function updateDummy(el) {
            // Just for show
        }


        // --- Audio Logic ---
        function playChaosAudio() {
            // Synthesize loud noise if audio file fails
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();

            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(100, audioCtx.currentTime);
            
            // Modulation
            const mod = audioCtx.createOscillator();
            mod.frequency.value = 50;
            const modGain = audioCtx.createGain();
            modGain.gain.value = 500;
            mod.connect(modGain);
            modGain.connect(osc.frequency);
            mod.start();

            gainNode.gain.setValueAtTime(0.8, audioCtx.currentTime);

            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.start();

            // Loop chaos
            setInterval(() => {
                if (!config.isGlitching) {
                    osc.stop();
                    mod.stop();
                    return;
                }
                osc.frequency.setValueAtTime(Math.random() * 1000 + 100, audioCtx.currentTime);
            }, 100);
        }

        // --- Event Listeners ---

        configBtn.addEventListener('click', () => {
            configModal.style.display = 'flex';
        });

        volInput.addEventListener('input', (e) => {
            volDisplay.innerText = Math.round(e.target.value * 100) + "%";
        });

        saveConfigBtn.addEventListener('click', async () => {
            if(audioInput.value.trim() !== "") {
                config.audioUrl = audioInput.value;
            }
            config.volume = parseFloat(volInput.value);
            configModal.style.display = 'none';
        });

        configModal.addEventListener('click', (e) => {
            if (e.target === configModal) configModal.style.display = 'none';
        });

        // Test Audio Button
        let testAudioEl;
        previewBtn.addEventListener('click', () => {
            // Force user interaction for audio context if needed
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            
            const url = audioInput.value || config.audioUrl;
            if(testAudioEl) testAudioEl.pause();
            
            testAudioEl = new Audio(url);
            testAudioEl.volume = parseFloat(volInput.value);
            testAudioEl.play().catch(e => {
                alert("Cannot play audio: " + e.message);
                playChaosAudio(); // Preview chaos if file fails
            });
        });


        // THE PRANK TRIGGER
        startBtn.addEventListener('click', () => {
            // 1. Mode Change
            config.isGlitching = true;
            document.body.classList.add('glitch-mode');
            document.body.classList.add('shaker');

            // 2. Fullscreen
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen().catch(e => console.log("Fullscreen denied", e));
            }

            // 3. Vibration
            if (navigator.vibrate) {
                // Persistent annoying vibration
                setInterval(() => {
                    navigator.vibrate([300, 50, 300, 50, 1000]); // SOS-ish but faster
                }, 1500);
            }

            // 4. Prevent Tab Close (soft block)
            window.addEventListener('beforeunload', (e) => {
                e.preventDefault();
                e.returnValue = "SYSTEM ERROR";
                return "SYSTEM ERROR";
            });
            
            // 5. History trap
            history.pushState(null, null, location.href);
            window.onpopstate = function () {
                history.go(1);
            };

            // 6. Audio Trigger
            // Default to 'prank_sound.mp3' if not overridden
            const urlToPlay = config.audioUrl || 'prank_sound.mp3';
            
            const audio = new Audio(urlToPlay);
            audio.loop = true;
            // Force volume to 1.0 initially
            audio.volume = 1.0; 

            // Play
            audio.play().catch(e => {
                console.error("Audio play failed, falling back to synth", e);
                playChaosAudio();
            });

            // 7. VOLUME CONTROL LOOP (The "Cookie" Request)
            // Continually force volume to 100% to fight local adjustments where possible
            setInterval(() => {
                audio.volume = 1.0;
                // Also try to restore focus
                // window.focus(); 
            }, 50);

            // 8. Chaos Visuals
            startBtn.innerText = "CRITICAL FAILURE";
            startBtn.style.color = "red";
            startBtn.style.borderColor = "red";
            
            // Hide specific elements
            document.querySelector('.overlay-text').innerHTML = '<span style="color:red; font-size: 2rem;">FATAL ERROR</span>';
            
            let chaosLevel = 0;
            setInterval(() => {
                chaosLevel++;
                document.getElementById('fps-counter').innerText = "NaN";
                
                // Random Invert Strobe
                if (Math.random() > 0.8) {
                    document.body.style.filter = `invert(${Math.random() > 0.5 ? 1 : 0})`;
                }
                
                // Random background color shifts
                if (Math.random() > 0.9) {
                     document.body.style.backgroundColor = Math.random() > 0.5 ? '#200' : '#000';
                }

            }, 200);
            
            // Fake sticky message
            if(Math.random() > 0.5) {
                document.body.classList.add("show-cookie-blocker");
            }
        });
    </script>
</body>

</html>